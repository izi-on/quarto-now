<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tic Tac Toe</title>
    <style>
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background: #f0f0f0;
        margin: 0;
        font-family: "Arial", sans-serif;
      }
      #game {
        display: grid;
        grid-template-columns: repeat(3, 100px);
        grid-template-rows: repeat(3, 100px);
        gap: 10px;
      }
      .cell {
        width: 100px;
        height: 100px;
        background: #fff;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 2rem;
        cursor: pointer;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }
      .cell.x {
        color: #ff3b30;
      }
      .cell.o {
        color: #007aff;
      }
      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <div id="game"></div>

    <script>
      const gameElement = document.getElementById("game");
      let board = Array(9).fill(null);
      let isMyTurn = false;

      // Create the grid
      board.forEach((cell, index) => {
        const cellElement = document.createElement("div");
        cellElement.classList.add("cell");
        cellElement.dataset.index = index;
        cellElement.addEventListener("click", handleCellClick);
        gameElement.appendChild(cellElement);
      });

      // Handle cell click events
      function handleCellClick(event) {
        if (!isMyTurn) return;

        const cellIndex = event.target.dataset.index;
        if (board[cellIndex]) return;

        makeMove(cellIndex, "x");
      }

      // Make a move on the board
      function makeMove(index, player) {
        board[index] = player;
        document
          .querySelector(`.cell[data-index="${index}"]`)
          .classList.add(player);
        isMyTurn = false;
        sendMessageToParent({ index, player });
      }

      // Receive moves from parent
      window.addEventListener("message", (event) => {
        const data = JSON.parse(event.data);
        if (data.hasOwnProperty("yourTurn") && data.yourTurn) {
          isMyTurn = true;
        } else if (data.index !== undefined && data.player) {
          makeMove(data.index, data.player);
        }
      });

      function sendMessageToParent(message) {
        window.parent.postMessage(JSON.stringify(message), "*");
      }
    </script>
  </body>
</html>
